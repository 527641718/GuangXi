var gs_gjj = [
	"{yfzcfzzhzbForm_h1l44}={yfzcfzzhzbForm_h1l1}+{yfzcfzzhzbForm_h1l2}+{yfzcfzzhzbForm_h1l3}+{yfzcfzzhzbForm_h1l4}+{yfzcfzzhzbForm_h1l5}+{yfzcfzzhzbForm_h1l6}+{yfzcfzzhzbForm_h1l7}+{yfzcfzzhzbForm_h1l8}+{yfzcfzzhzbForm_h1l9}+{yfzcfzzhzbForm_h1l10}+{yfzcfzzhzbForm_h1l11}+{yfzcfzzhzbForm_h1l12}+{yfzcfzzhzbForm_h1l13}+{yfzcfzzhzbForm_h1l14}+{yfzcfzzhzbForm_h1l15}+{yfzcfzzhzbForm_h1l16}+{yfzcfzzhzbForm_h1l17}+{yfzcfzzhzbForm_h1l18}+{yfzcfzzhzbForm_h1l19}+{yfzcfzzhzbForm_h1l20}",
	"{yfzcfzzhzbForm_h2l44}={yfzcfzzhzbForm_h2l1}+{yfzcfzzhzbForm_h2l2}+{yfzcfzzhzbForm_h2l3}+{yfzcfzzhzbForm_h2l4}+{yfzcfzzhzbForm_h2l5}+{yfzcfzzhzbForm_h2l6}+{yfzcfzzhzbForm_h2l7}+{yfzcfzzhzbForm_h2l8}+{yfzcfzzhzbForm_h2l9}+{yfzcfzzhzbForm_h2l10}+{yfzcfzzhzbForm_h2l11}+{yfzcfzzhzbForm_h2l12}+{yfzcfzzhzbForm_h2l13}+{yfzcfzzhzbForm_h2l14}+{yfzcfzzhzbForm_h2l15}+{yfzcfzzhzbForm_h2l16}+{yfzcfzzhzbForm_h2l17}+{yfzcfzzhzbForm_h2l18}+{yfzcfzzhzbForm_h2l19}+{yfzcfzzhzbForm_h2l20}",
	"{yfzcfzzhzbForm_h3l44}={yfzcfzzhzbForm_h3l1}+{yfzcfzzhzbForm_h3l2}+{yfzcfzzhzbForm_h3l3}+{yfzcfzzhzbForm_h3l4}+{yfzcfzzhzbForm_h3l5}+{yfzcfzzhzbForm_h3l6}+{yfzcfzzhzbForm_h3l7}+{yfzcfzzhzbForm_h3l8}+{yfzcfzzhzbForm_h3l9}+{yfzcfzzhzbForm_h3l10}+{yfzcfzzhzbForm_h3l11}+{yfzcfzzhzbForm_h3l12}+{yfzcfzzhzbForm_h3l13}+{yfzcfzzhzbForm_h3l14}+{yfzcfzzhzbForm_h3l15}+{yfzcfzzhzbForm_h3l16}+{yfzcfzzhzbForm_h3l17}+{yfzcfzzhzbForm_h3l18}+{yfzcfzzhzbForm_h3l19}+{yfzcfzzhzbForm_h3l20}",
	"{yfzcfzzhzbForm_h4l44}={yfzcfzzhzbForm_h4l1}+{yfzcfzzhzbForm_h4l2}+{yfzcfzzhzbForm_h4l3}+{yfzcfzzhzbForm_h4l4}+{yfzcfzzhzbForm_h4l5}+{yfzcfzzhzbForm_h4l6}+{yfzcfzzhzbForm_h4l7}+{yfzcfzzhzbForm_h4l8}+{yfzcfzzhzbForm_h4l9}+{yfzcfzzhzbForm_h4l10}+{yfzcfzzhzbForm_h4l11}+{yfzcfzzhzbForm_h4l12}+{yfzcfzzhzbForm_h4l13}+{yfzcfzzhzbForm_h4l14}+{yfzcfzzhzbForm_h4l15}+{yfzcfzzhzbForm_h4l16}+{yfzcfzzhzbForm_h4l17}+{yfzcfzzhzbForm_h4l18}+{yfzcfzzhzbForm_h4l19}+{yfzcfzzhzbForm_h4l20}",
	"{yfzcfzzhzbForm_h5l44}={yfzcfzzhzbForm_h5l1}+{yfzcfzzhzbForm_h5l2}+{yfzcfzzhzbForm_h5l3}+{yfzcfzzhzbForm_h5l4}+{yfzcfzzhzbForm_h5l5}+{yfzcfzzhzbForm_h5l6}+{yfzcfzzhzbForm_h5l7}+{yfzcfzzhzbForm_h5l8}+{yfzcfzzhzbForm_h5l9}+{yfzcfzzhzbForm_h5l10}+{yfzcfzzhzbForm_h5l11}+{yfzcfzzhzbForm_h5l12}+{yfzcfzzhzbForm_h5l13}+{yfzcfzzhzbForm_h5l14}+{yfzcfzzhzbForm_h5l15}+{yfzcfzzhzbForm_h5l16}+{yfzcfzzhzbForm_h5l17}+{yfzcfzzhzbForm_h5l18}+{yfzcfzzhzbForm_h5l19}+{yfzcfzzhzbForm_h5l20}",
	"{yfzcfzzhzbForm_h6l44}={yfzcfzzhzbForm_h6l1}+{yfzcfzzhzbForm_h6l2}+{yfzcfzzhzbForm_h6l3}+{yfzcfzzhzbForm_h6l4}+{yfzcfzzhzbForm_h6l5}+{yfzcfzzhzbForm_h6l6}+{yfzcfzzhzbForm_h6l7}+{yfzcfzzhzbForm_h6l8}+{yfzcfzzhzbForm_h6l9}+{yfzcfzzhzbForm_h6l10}+{yfzcfzzhzbForm_h6l11}+{yfzcfzzhzbForm_h6l12}+{yfzcfzzhzbForm_h6l13}+{yfzcfzzhzbForm_h6l14}+{yfzcfzzhzbForm_h6l15}+{yfzcfzzhzbForm_h6l16}+{yfzcfzzhzbForm_h6l17}+{yfzcfzzhzbForm_h6l18}+{yfzcfzzhzbForm_h6l19}+{yfzcfzzhzbForm_h6l20}",
	"{yfzcfzzhzbForm_h1l41}={yfzcfzzhzbForm_h1l21}+{yfzcfzzhzbForm_h1l22}+{yfzcfzzhzbForm_h1l23}+{yfzcfzzhzbForm_h1l24}+{yfzcfzzhzbForm_h1l25}+{yfzcfzzhzbForm_h1l26}+{yfzcfzzhzbForm_h1l27}+{yfzcfzzhzbForm_h1l28}+{yfzcfzzhzbForm_h1l29}+{yfzcfzzhzbForm_h1l30}+{yfzcfzzhzbForm_h1l31}+{yfzcfzzhzbForm_h1l32}+{yfzcfzzhzbForm_h1l33}+{yfzcfzzhzbForm_h1l34}+{yfzcfzzhzbForm_h1l35}+{yfzcfzzhzbForm_h1l36}+{yfzcfzzhzbForm_h1l37}+{yfzcfzzhzbForm_h1l38}+{yfzcfzzhzbForm_h1l39}+{yfzcfzzhzbForm_h1l40}",
	"{yfzcfzzhzbForm_h2l41}={yfzcfzzhzbForm_h2l21}+{yfzcfzzhzbForm_h2l22}+{yfzcfzzhzbForm_h2l23}+{yfzcfzzhzbForm_h2l24}+{yfzcfzzhzbForm_h2l25}+{yfzcfzzhzbForm_h2l26}+{yfzcfzzhzbForm_h2l27}+{yfzcfzzhzbForm_h2l28}+{yfzcfzzhzbForm_h2l29}+{yfzcfzzhzbForm_h2l30}+{yfzcfzzhzbForm_h2l31}+{yfzcfzzhzbForm_h2l32}+{yfzcfzzhzbForm_h2l33}+{yfzcfzzhzbForm_h2l34}+{yfzcfzzhzbForm_h2l35}+{yfzcfzzhzbForm_h2l36}+{yfzcfzzhzbForm_h2l37}+{yfzcfzzhzbForm_h2l38}+{yfzcfzzhzbForm_h2l39}+{yfzcfzzhzbForm_h2l40}",
	"{yfzcfzzhzbForm_h3l41}={yfzcfzzhzbForm_h3l21}+{yfzcfzzhzbForm_h3l22}+{yfzcfzzhzbForm_h3l23}+{yfzcfzzhzbForm_h3l24}+{yfzcfzzhzbForm_h3l25}+{yfzcfzzhzbForm_h3l26}+{yfzcfzzhzbForm_h3l27}+{yfzcfzzhzbForm_h3l28}+{yfzcfzzhzbForm_h3l29}+{yfzcfzzhzbForm_h3l30}+{yfzcfzzhzbForm_h3l31}+{yfzcfzzhzbForm_h3l32}+{yfzcfzzhzbForm_h3l33}+{yfzcfzzhzbForm_h3l34}+{yfzcfzzhzbForm_h3l35}+{yfzcfzzhzbForm_h3l36}+{yfzcfzzhzbForm_h3l37}+{yfzcfzzhzbForm_h3l38}+{yfzcfzzhzbForm_h3l39}+{yfzcfzzhzbForm_h3l40}",
	"{yfzcfzzhzbForm_h4l41}={yfzcfzzhzbForm_h4l21}+{yfzcfzzhzbForm_h4l22}+{yfzcfzzhzbForm_h4l23}+{yfzcfzzhzbForm_h4l24}+{yfzcfzzhzbForm_h4l25}+{yfzcfzzhzbForm_h4l26}+{yfzcfzzhzbForm_h4l27}+{yfzcfzzhzbForm_h4l28}+{yfzcfzzhzbForm_h4l29}+{yfzcfzzhzbForm_h4l30}+{yfzcfzzhzbForm_h4l31}+{yfzcfzzhzbForm_h4l32}+{yfzcfzzhzbForm_h4l33}+{yfzcfzzhzbForm_h4l34}+{yfzcfzzhzbForm_h4l35}+{yfzcfzzhzbForm_h4l36}+{yfzcfzzhzbForm_h4l37}+{yfzcfzzhzbForm_h4l38}+{yfzcfzzhzbForm_h4l39}+{yfzcfzzhzbForm_h4l40}",
	"{yfzcfzzhzbForm_h5l41}={yfzcfzzhzbForm_h5l21}+{yfzcfzzhzbForm_h5l22}+{yfzcfzzhzbForm_h5l23}+{yfzcfzzhzbForm_h5l24}+{yfzcfzzhzbForm_h5l25}+{yfzcfzzhzbForm_h5l26}+{yfzcfzzhzbForm_h5l27}+{yfzcfzzhzbForm_h5l28}+{yfzcfzzhzbForm_h5l29}+{yfzcfzzhzbForm_h5l30}+{yfzcfzzhzbForm_h5l31}+{yfzcfzzhzbForm_h5l32}+{yfzcfzzhzbForm_h5l33}+{yfzcfzzhzbForm_h5l34}+{yfzcfzzhzbForm_h5l35}+{yfzcfzzhzbForm_h5l36}+{yfzcfzzhzbForm_h5l37}+{yfzcfzzhzbForm_h5l38}+{yfzcfzzhzbForm_h5l39}+{yfzcfzzhzbForm_h5l40}",
	"{yfzcfzzhzbForm_h6l41}={yfzcfzzhzbForm_h6l21}+{yfzcfzzhzbForm_h6l22}+{yfzcfzzhzbForm_h6l23}+{yfzcfzzhzbForm_h6l24}+{yfzcfzzhzbForm_h6l25}+{yfzcfzzhzbForm_h6l26}+{yfzcfzzhzbForm_h6l27}+{yfzcfzzhzbForm_h6l28}+{yfzcfzzhzbForm_h6l29}+{yfzcfzzhzbForm_h6l30}+{yfzcfzzhzbForm_h6l31}+{yfzcfzzhzbForm_h6l32}+{yfzcfzzhzbForm_h6l33}+{yfzcfzzhzbForm_h6l34}+{yfzcfzzhzbForm_h6l35}+{yfzcfzzhzbForm_h6l36}+{yfzcfzzhzbForm_h6l37}+{yfzcfzzhzbForm_h6l38}+{yfzcfzzhzbForm_h6l39}+{yfzcfzzhzbForm_h6l40}"];
var beSbdr = false;
var fbXMLData = {};
var cfcjbz; //重复采集标记
function initV(resData) {
    if (parent.cxbj == 'N') {
        $w("qykjzdInner").setDisabled("bcBtn");
        $w("qykjzdInner").setDisabled("qxBtn");
        $w("bcBtn").disabled();
        $w("qxBtn").disabled();
        $w("yfzcfzzhzbForm").disable();
        $w("yfzcfzzhzbGrid").readonly();
    }
    var nsrxxMap = parent.zlbsNsrxxMap;
    var nsrsbh = nsrxxMap.data.nsrsbh.value;
    var nsrmc = nsrxxMap.data.nsrmc.value;

    fbXMLData["yfzcfzzhzbForm"] = parent.zlbsfbsaveData.get("“研发支出”辅助账汇总表1");
    if (fbXMLData["yfzcfzzhzbForm"] != null && fbXMLData["yfzcfzzhzbForm"] != undefined && fbXMLData["yfzcfzzhzbForm"].sword != null && fbXMLData["yfzcfzzhzbForm"].sword != undefined && fbXMLData["yfzcfzzhzbForm"].sword != "") {
        $w("yfzcfzzhzbForm").initData(fbXMLData["yfzcfzzhzbForm"]);
        //$w("yfzcfzzhzbForm").initData(parent.zlbsfbsaveData.get("“研发支出”辅助账汇总表1"));
    }
    fbXMLData["yfzcfzzhzbGrid"] = parent.zlbsfbsaveData.get("“研发支出”辅助账汇总表2");
    if (fbXMLData["yfzcfzzhzbGrid"] != null && fbXMLData["yfzcfzzhzbGrid"] != undefined && fbXMLData["yfzcfzzhzbGrid"].sword != null && fbXMLData["yfzcfzzhzbGrid"].sword != undefined && fbXMLData["yfzcfzzhzbGrid"].sword != "") {
        $w("yfzcfzzhzbGrid").initData(fbXMLData["yfzcfzzhzbGrid"]);
        //$w("yfzcfzzhzbGrid").initData(parent.zlbsfbsaveData.get("“研发支出”辅助账汇总表2"));
    }

    $w("nsrxxForm").setValue("nsrsbh", nsrsbh);
    $w("nsrxxForm").setValue("nsrmc", nsrmc);
    var ssqq = "";
    var skssqq = nsrxxMap.data.skssqq.value;
    if ($chk(skssqq)) {
        ssqq = skssqq.substring(0, 4);
        $w("nsrxxForm").setValue("bsnd", ssqq);
    }
    parent.$w('zzsybnsrsb').setDisabled('save');
    parent.$w('zzsybnsrsb').setDisabled('import');
    parent.$w('zzsybnsrsb').setDisabled('reset');
    //错误更正时,需要初始化单元格状态
    initCheckAllRows();
    //开始增加网报特色
    if (parent.beSbdr && beSbdr == false) {
        parent.$w('zzsybnsrsb').setEnabled('save');
        parent.$w('zzsybnsrsb').setEnabled('import');
        parent.$w('zzsybnsrsb').setEnabled('reset');

        if ((fbXMLData["yfzcfzzhzbForm"] != null && fbXMLData["yfzcfzzhzbForm"] != undefined && fbXMLData["yfzcfzzhzbForm"].sword != null && fbXMLData["yfzcfzzhzbForm"].sword != undefined && fbXMLData["yfzcfzzhzbForm"].sword != "") || (fbXMLData["yfzcfzzhzbGrid"] != null && fbXMLData["yfzcfzzhzbGrid"] != undefined && fbXMLData["yfzcfzzhzbGrid"].sword != null && fbXMLData["yfzcfzzhzbGrid"].sword != undefined && fbXMLData["yfzcfzzhzbGrid"].sword != "")) {
            beSbdr = true;
            (function () {
                var inputs = $$('input');
                inputs.each(function (input, idx) {
                    if (input.id != "") {
                        (function () {
                            caculate(input.id);
                        }).delay(1);


                    }
                });
                savefb();
                beSbdr = false;
            }).delay(1);
        }
    }
}
/**
 * 保存操作
 */
function savefb() {

    var yfzcfzzhzbForm = $w("yfzcfzzhzbForm");
    var yfzcfzzhzbGrid = $w("yfzcfzzhzbGrid");
    if (!yfzcfzzhzbForm.validate()) {
        return;
    }
    if (!yfzcfzzhzbGrid.validate()) {
        return;
    }
    if (!beSbdr) {
        parent.alertmes("“研发支出”辅助账汇总表采集完成且发送成功!");
    }
    parent.zlbsfbsaveData.set("“研发支出”辅助账汇总表", "a");
    parent.zlbsfbsaveData.set("“研发支出”辅助账汇总表1", yfzcfzzhzbForm.getSubmitData());
    parent.zlbsfbsaveData.set("“研发支出”辅助账汇总表2", yfzcfzzhzbGrid.getAllNoDeleteGridData());
    var id = "table00";
    parent.$("table00").setStyle('display', '');

    var iframes = parent.document.getElementsByTagName('iframe');
    for (var num = 0; num < iframes.length; num++) {
        var ifram = iframes[num];
        var iframid = ifram.id;
        var tableid = iframid.substring(0, iframid.indexOf("iframe"));
        if ($chk(tableid)) {
            parent.$(tableid).setStyle('display', 'none');
        }
    }
    parent.$w('zzsybnsrsb').setEnabled('save');
    parent.$w('zzsybnsrsb').setEnabled('reset');
    parent.$w('zzsybnsrsb').setEnabled('import');

}

function reset() {
    parent.zlbsfbsaveData.set("“研发支出”辅助账汇总表1", null);
    parent.zlbsfbsaveData.set("“研发支出”辅助账汇总表2", null);
    $w("yfzcfzzhzbForm").reset();
    $w("yfzcfzzhzbGrid").reset();
    insertAllRows();
}

function changesszt(option, selItem, obj) {
    checkYfcg();
}

/**
 * 监控 研发成果和研发成果证书号：当项目实施状态为“未完成”，或者项目实施状态为“已完成”但是同一项目名称本年有两条明细的时候，“研发成果”和“研发成果证书号”不可填写
 * @return
 */
function checkYfcg() {
    var grid = $w("yfzcfzzhzbGrid");
    var allRows = grid.dataDiv().getChildren('div[status!=delete]'); //grid.getAllNoDeleteGridData().trs;
    if ($chk(allRows)) {
        for (var i = 0; i < allRows.length; i++) {
            var oneRow = allRows[i];
            checkYfcgOneRow(i, oneRow, allRows);
        }
    }
}

function checkYfcgOneRow(index, oneRow, allRows) {
    var grid = $w("yfzcfzzhzbGrid");
    var cell = oneRow.getCell("yfcg");
    var cellYfcgzsh = oneRow.getCell("yfcgzsh");

    var xmmc = oneRow.getCell("xmmc").realvalue; //oneRow.getValue("xmmc");//项目名称
    var haveMoreRows = false;
    for (var j = 0; j < allRows.length; j++) {
        if (index == j) { //不与自己比较
            continue;
        }
        var otherRow = allRows[j];
        var xmmc2 = otherRow.getCell("xmmc").realvalue; //otherRow.getValue("xmmc");//项目名称
        if (xmmc == xmmc2) { //项目名称相同，则相同的项目名称多于一条
            haveMoreRows = true;
            break;
        }
    }
    var sszt = oneRow.getCell("xmssztxx").realvalue;
    if (haveMoreRows || sszt == "01") { // 项目实施状态为 未完成，或者同一项目名称本年有两条以上明细的时候，不可录入
        grid.updateCell(cell, "", "");
        grid.setCellRule(oneRow, cell, "");
        grid.cellDisable(cell);
        grid.updateCell(cellYfcgzsh, "", "");
        grid.setCellRule(oneRow, cellYfcgzsh, "");
        grid.cellDisable(cellYfcgzsh);
    } else {
        grid.setCellRule(oneRow, cell, "must");
        grid.cellEnable(cell);
        grid.setCellRule(oneRow, cellYfcgzsh, "must");
        grid.cellEnable(cellYfcgzsh);
    }
}

function js() {
    var grid = $w("yfzcfzzhzbGrid");
    //var rowdata = grid.getCheckedRowData();
    var row = grid.getCheckedRow();
    jsOneRow(row);
}

function jsOneRow(row) {
    var grid = $w("yfzcfzzhzbGrid");
    var rowdata = grid.getOneRowData(row);
    var f001 = tonumber(rowdata.getValue("f001"));
    var f002 = tonumber(rowdata.getValue("f002"));
    var f003 = tonumber(rowdata.getValue("f003"));
    var f004 = tonumber(rowdata.getValue("f004"));
    var f005 = tonumber(rowdata.getValue("f005"));
    var f006 = tonumber(rowdata.getValue("f006"));
    var f007 = tonumber(rowdata.getValue("f007"));
    var f008 = tonumber(rowdata.getValue("f008"));
    var f009 = tonumber(rowdata.getValue("f009"));
    var f010 = tonumber(rowdata.getValue("f010"));
    var f011 = tonumber(rowdata.getValue("f011"));
    var f012 = tonumber(rowdata.getValue("f012"));
    var f013 = tonumber(rowdata.getValue("f013"));
    var f014 = tonumber(rowdata.getValue("f014"));
    var f015 = tonumber(rowdata.getValue("f015"));
    var f016 = tonumber(rowdata.getValue("f016"));
    var f017 = tonumber(rowdata.getValue("f017"));
    var f018 = tonumber(rowdata.getValue("f018"));
    var f019 = tonumber(rowdata.getValue("f019"));
    var f020 = tonumber(rowdata.getValue("f020"));
    var f021 = tonumber(rowdata.getValue("f021"));
    var f022 = tonumber(rowdata.getValue("f022"));
    var f023 = tonumber(rowdata.getValue("f023"));
    var f024 = tonumber(rowdata.getValue("f024"));
    var f025 = tonumber(rowdata.getValue("f025"));
    var f026 = tonumber(rowdata.getValue("f026"));
    var f027 = tonumber(rowdata.getValue("f027"));
    var f028 = tonumber(rowdata.getValue("f028"));
    var f029 = tonumber(rowdata.getValue("f029"));
    var f030 = tonumber(rowdata.getValue("f030"));
    var f031 = tonumber(rowdata.getValue("f031"));
    var f032 = tonumber(rowdata.getValue("f032"));
    var f033 = tonumber(rowdata.getValue("f033"));
    var f034 = tonumber(rowdata.getValue("f034"));
    var f035 = tonumber(rowdata.getValue("f035"));
    var f036 = tonumber(rowdata.getValue("f036"));
    var f037 = tonumber(rowdata.getValue("f037"));
    var f038 = tonumber(rowdata.getValue("f038"));
    var f039 = tonumber(rowdata.getValue("f039"));
    var f040 = tonumber(rowdata.getValue("f040"));
    var f041 = f021.accAdd(f022).accAdd(f023).accAdd(f024).accAdd(f025).accAdd(f026).accAdd(f027).accAdd(f028)
		.accAdd(f029).accAdd(f030).accAdd(f031).accAdd(f032).accAdd(f033).accAdd(f034).accAdd(f035).accAdd(f036)
		.accAdd(f037).accAdd(f038).accAdd(f039).accAdd(f040);

    var f041Cell = row.getCell("f041");
    grid.updateCell(f041Cell, f041.round(2));

    var f044 = f001.accAdd(f002).accAdd(f003).accAdd(f004).accAdd(f005).accAdd(f006).accAdd(f007).accAdd(f008)
		.accAdd(f009).accAdd(f010).accAdd(f011).accAdd(f012).accAdd(f013).accAdd(f014).accAdd(f015).accAdd(f016)
		.accAdd(f017).accAdd(f018).accAdd(f019).accAdd(f020);

    var f044Cell = row.getCell("f044");
    grid.updateCell(f044Cell, f044.round(2));

    var f045 = (f044.multiple(0.1)).divide(0.9);
    var f045Cell = row.getCell("f045");
    grid.updateCell(f045Cell, f045.round(2));

    var wtfystfsfczglgxxx = rowdata.getValue("wtfystfsfczglgxxx");
    var sfwtjwxx = rowdata.getValue("sfwtjwxx");
    var f043 = 0.0;
    var f042 = tonumber(rowdata.getValue("f042"));
    var f043Cell = row.getCell("f043");
    if ("02" == wtfystfsfczglgxxx && "02" == sfwtjwxx) { //委托方与受托方是否存在关联关系选项 不存在,“是否委托境外选项”:委托境外
        f043 = f042;
        grid.updateCell(f043Cell, f043);
    } else if ("01" == wtfystfsfczglgxxx && "02" == sfwtjwxx) { //委托方与受托方是否存在关联关系选项 存在,“是否委托境外选项”:委托境外
        f043 = f044.accAdd(f041).round(2);
        grid.updateCell(f043Cell, f043);
    } else if ("01" == sfwtjwxx) { // 是否委托境外选项”:委托境内。//2017-06-05桂丽娟答复：业务组老师说委托境内的时候，// 7.1应该取0
        f043 = 0.0;
        grid.updateCell(f043Cell, f043);
    }

    yfxs = rowdata.getValue("yfxs");
    zbhfyhzcxx = rowdata.getValue("zbhfyhzcxx");
    var minval = 0.0;
    if (f041 > f045) {
        minval = f045;
    } else {
        minval = f041;
    }
    var f046 = 0.0;
    var f046Cell = row.getCell("f046");
    if ("2" == yfxs && "02" == zbhfyhzcxx && "01" == wtfystfsfczglgxxx) { //委托方与受托方是否存在关联关系选项:存在, 研发形式:委托研发, 资本化、费用化支出选项 :费用化
        f046 = f044.accAdd(minval).subtract(f043).multiple(0.8).round(2);
        grid.updateCell(f046Cell, f046);
    } else if ("2" == yfxs && "02" == zbhfyhzcxx && "02" == wtfystfsfczglgxxx) { //委托方与受托方是否存在关联关系选项:不存在,研发形式:委托研发, 资本化、费用化支出选项 :费用化
        f046 = (f042.subtract(f043)).multiple(0.8).round(2);
        grid.updateCell(f046Cell, f046);
    } else if ("2" != yfxs && "02" == zbhfyhzcxx) { //资本化、费用化支出选项 :费用化, 研发形式:委托研发
        f046 = f044.accAdd(minval).round(2);
        grid.updateCell(f046Cell, f046);
    } else {
        grid.updateCell(f046Cell, "");
        grid.cellDisable(f046Cell);
    }

    var f047 = 0.0;
    var f047Cell = row.getCell("f047");
    var xmssztxx = rowdata.getValue("xmssztxx");
    if ("02" == xmssztxx && "2" == yfxs && "01" == wtfystfsfczglgxxx) {
        if (0 != f041.accAdd(f044)) {
            f047 = ((f044.accAdd(minval).subtract(f043)).multiple(0.8)).divide((f041.accAdd(f044))).round(2);
        }
        grid.updateCell(f047Cell, f047);
    } else if ("01" == zbhfyhzcxx && "02" == xmssztxx && "2" == yfxs && "02" == wtfystfsfczglgxxx) {
        if (0 != f042) {
            f047 = ((f042.subtract(f043)).multiple(0.8)).divide(f042).round(2);
        }
        grid.updateCell(f047Cell, f047);
    } else if ("01" == zbhfyhzcxx && "02" == xmssztxx && "2" != yfxs) {
        if (0 != f041.accAdd(f044)) {
            f047 = (f044.accAdd(minval)).divide(((f041.accAdd(f044)))).round(2);
        }
        grid.updateCell(f047Cell, f047);
    } else {
        grid.updateCell(f047Cell, "");
        grid.cellDisable(f047Cell);
    }
}

function changeyfxs(option, selItem, obj) {
    var grid = $w("yfzcfzzhzbGrid");
    var row = grid.getCheckedRow();
    checkYfxsOneRow(row);
    js();
}

function checkYfxsOneRow(row) {
    var grid = $w("yfzcfzzhzbGrid");
    var yfxs = row.getCell("yfxs").realvalue; // 研发形式
    var cell = row.getCell("wtfystfsfczglgxxx");
    var cell1 = row.getCell("sfwtjwxx");

    if ("2" != yfxs) {
        grid.updateCell(cell1, "");
        grid.cellDisable(cell1);
        grid.setCellRule(row, cell1, "");
        grid.updateCell(cell, "");
        grid.cellDisable(cell);
        grid.setCellRule(row, cell, "");
    } else {
        grid.cellEnable(cell);
        grid.cellEnable(cell1);
        grid.setCellRule(row, cell, "must");
        grid.setCellRule(row, cell1, "must");
    }
}

function tonumber(num) {
    if ($chk(num)) {
        return parseFloat(num);
    } else {
        return 0.0;
    }
}

function disable(rowData, rowEl, obj) {
    if (parent.cxbj == 'N') {
        obj.disableRow(rowEl);
    }
}

function initCheckAllRows() {
    var grid = $w("yfzcfzzhzbGrid");
    var allRows = grid.dataDiv().getChildren('div[status!=delete]'); //grid.getAllNoDeleteGridData().trs;
    if ($chk(allRows)) {
        for (var i = 0; i < allRows.length; i++) {
            var oneRow = allRows[i];
            checkYfcgOneRow(i, oneRow, allRows);
            checkYfxsOneRow(oneRow);
            jsOneRow(oneRow);
        }
    }
}

function deleteRows() {
    var grid = $w("yfzcfzzhzbGrid");
    var row = grid.getCheckedRow();
    if (row == null || row.length < 1) {
        swordAlert('请选择需要删除的行。');
        return;
    }
    swordConfirm('确定删除？', {
        okBtnName: "是",
        cancelBtnName: "否",
        onOk: function () {
            var rowdata = grid.getCheckedRowData();
            var xmmc = rowdata.getValue("xmmc");
            grid.deleteRow(row); //删行
            var allRows = grid.dataDiv().getChildren('div[status!=delete]'); //grid.getAllNoDeleteGridData().trs;
            if ($chk(allRows)) {
                for (var i = 0; i < allRows.length; i++) {
                    var oneRow = allRows[i];
                    var xmmc2 = oneRow.getCell("xmmc").realvalue;
                    if (xmmc == xmmc2) {
                        checkYfcgOneRow(i, oneRow, allRows);
                    }
                }
            }
        },
        onCancel: function () {

        }
    });
}

function inserow() {
    //首先获取最大二维表行序号
    var data = {
        'tds': {
            'f001': {
                'value': '0.00'
            },
            'f002': {
                'value': '0.00'
            },
            'f003': {
                'value': '0.00'
            },
            'f004': {
                'value': '0.00'
            },
            'f005': {
                'value': '0.00'
            },
            'f006': {
                'value': '0.00'
            },
            'f007': {
                'value': '0.00'
            },
            'f008': {
                'value': '0.00'
            },
            'f009': {
                'value': '0.00'
            },
            'f010': {
                'value': '0.00'
            },
            'f011': {
                'value': '0.00'
            },
            'f012': {
                'value': '0.00'
            },
            'f013': {
                'value': '0.00'
            },
            'f014': {
                'value': '0.00'
            },
            'f015': {
                'value': '0.00'
            },
            'f016': {
                'value': '0.00'
            },
            'f017': {
                'value': '0.00'
            },
            'f018': {
                'value': '0.00'
            },
            'f019': {
                'value': '0.00'
            },
            'f020': {
                'value': '0.00'
            },
            'f021': {
                'value': '0.00'
            },
            'f022': {
                'value': '0.00'
            },
            'f023': {
                'value': '0.00'
            },
            'f024': {
                'value': '0.00'
            },
            'f025': {
                'value': '0.00'
            },
            'f026': {
                'value': '0.00'
            },
            'f027': {
                'value': '0.00'
            },
            'f028': {
                'value': '0.00'
            },
            'f029': {
                'value': '0.00'
            },
            'f030': {
                'value': '0.00'
            },
            'f031': {
                'value': '0.00'
            },
            'f032': {
                'value': '0.00'
            },
            'f033': {
                'value': '0.00'
            },
            'f034': {
                'value': '0.00'
            },
            'f035': {
                'value': '0.00'
            },
            'f036': {
                'value': '0.00'
            },
            'f037': {
                'value': '0.00'
            },
            'f038': {
                'value': '0.00'
            },
            'f039': {
                'value': '0.00'
            },
            'f040': {
                'value': '0.00'
            },
            'f041': {
                'value': '0.00'
            },
            'f042': {
                'value': '0.00'
            },
            'f043': {
                'value': '0.00'
            },
            'f044': {
                'value': '0.00'
            },
            'f045': {
                'value': '0.00'
            },
            'f046': {
                'value': '0.00'
            },
            'f047': {
                'value': '0.00'
            }
        }
    };
    $w("yfzcfzzhzbGrid").insertRow(data);
}

function insertAllRows() {
    var data = {
        'tds': {
            'f001': {
                'value': '0.00'
            },
            'f002': {
                'value': '0.00'
            },
            'f003': {
                'value': '0.00'
            },
            'f004': {
                'value': '0.00'
            },
            'f005': {
                'value': '0.00'
            },
            'f006': {
                'value': '0.00'
            },
            'f007': {
                'value': '0.00'
            },
            'f008': {
                'value': '0.00'
            },
            'f009': {
                'value': '0.00'
            },
            'f010': {
                'value': '0.00'
            },
            'f011': {
                'value': '0.00'
            },
            'f012': {
                'value': '0.00'
            },
            'f013': {
                'value': '0.00'
            },
            'f014': {
                'value': '0.00'
            },
            'f015': {
                'value': '0.00'
            },
            'f016': {
                'value': '0.00'
            },
            'f017': {
                'value': '0.00'
            },
            'f018': {
                'value': '0.00'
            },
            'f019': {
                'value': '0.00'
            },
            'f020': {
                'value': '0.00'
            },
            'f021': {
                'value': '0.00'
            },
            'f022': {
                'value': '0.00'
            },
            'f023': {
                'value': '0.00'
            },
            'f024': {
                'value': '0.00'
            },
            'f025': {
                'value': '0.00'
            },
            'f026': {
                'value': '0.00'
            },
            'f027': {
                'value': '0.00'
            },
            'f028': {
                'value': '0.00'
            },
            'f029': {
                'value': '0.00'
            },
            'f030': {
                'value': '0.00'
            },
            'f031': {
                'value': '0.00'
            },
            'f032': {
                'value': '0.00'
            },
            'f033': {
                'value': '0.00'
            },
            'f034': {
                'value': '0.00'
            },
            'f035': {
                'value': '0.00'
            },
            'f036': {
                'value': '0.00'
            },
            'f037': {
                'value': '0.00'
            },
            'f038': {
                'value': '0.00'
            },
            'f039': {
                'value': '0.00'
            },
            'f040': {
                'value': '0.00'
            },
            'f041': {
                'value': '0.00'
            },
            'f042': {
                'value': '0.00'
            },
            'f043': {
                'value': '0.00'
            },
            'f044': {
                'value': '0.00'
            },
            'f045': {
                'value': '0.00'
            },
            'f046': {
                'value': '0.00'
            },
            'f047': {
                'value': '0.00'
            }
        }
    };
    $w("yfzcfzzhzbGrid").insertRow(data);
}

/**
 * 附表打印函数
 * @return
 */
function setFbdymbuuid() {
    parent.dymbuuid = "sb000_yfzcfzzhzb";
    parent.hxdyForPrint = "Y";
    parent.fykg = "Y";
    parent.zzlx = "A3";
    parent.caculateGridHJFlag = "Y";
    parent.tsxx = '<span style="font-size: 28px;font-weight: bold;color: red;">尊敬的用户您好,“研发支出”辅助账汇总表数据量过大,建议使用打印->导出功能保存采集凭证</span>';
    parent.printMode = '{"PRINT_PAGE_PERCENT":"28%"}';
    parent.printTitle = "“研发支出”辅助账汇总表";
}