var gs_gjj = [
		"{zcfzbxxForm_h14l2}={zcfzbxxForm_h1l2}+{zcfzbxxForm_h2l2}+{zcfzbxxForm_h3l2}+{zcfzbxxForm_h4l2}+"
				+ "{zcfzbxxForm_h5l2}+{zcfzbxxForm_h6l2}+{zcfzbxxForm_h7l2}+{zcfzbxxForm_h8l2}+"
				+ "{zcfzbxxForm_h9l2}+{zcfzbxxForm_h10l2}+{zcfzbxxForm_h11l2}+{zcfzbxxForm_h12l2}+"
				+ "{zcfzbxxForm_h13l2}",
		"{zcfzbxxForm_h17l2}={zcfzbxxForm_h15l2}+{zcfzbxxForm_h16l2}",
		"{zcfzbxxForm_h21l2}={zcfzbxxForm_h19l2}-{zcfzbxxForm_h20l2}",
		"{zcfzbxxForm_h23l2}={zcfzbxxForm_h21l2}-{zcfzbxxForm_h22l2}",
		"{zcfzbxxForm_h27l2}={zcfzbxxForm_h23l2}+{zcfzbxxForm_h24l2}+{zcfzbxxForm_h25l2}+{zcfzbxxForm_h26l2}",
		"{zcfzbxxForm_h32l2}={zcfzbxxForm_h29l2}+{zcfzbxxForm_h30l2}+{zcfzbxxForm_h31l2}",
		"{zcfzbxxForm_h36l2}={zcfzbxxForm_h14l2}+{zcfzbxxForm_h17l2}+{zcfzbxxForm_h27l2}+{zcfzbxxForm_h32l2}+"
				+ "{zcfzbxxForm_h35l2}",

		"{zcfzbxxForm_h14l3}={zcfzbxxForm_h1l3}+{zcfzbxxForm_h2l3}+{zcfzbxxForm_h3l3}+{zcfzbxxForm_h4l3}+"
				+ "{zcfzbxxForm_h5l3}+{zcfzbxxForm_h6l3}+{zcfzbxxForm_h7l3}+{zcfzbxxForm_h8l3}+"
				+ "{zcfzbxxForm_h9l3}+{zcfzbxxForm_h10l3}+{zcfzbxxForm_h11l3}+{zcfzbxxForm_h12l3}+"
				+ "{zcfzbxxForm_h13l3}",
		"{zcfzbxxForm_h17l3}={zcfzbxxForm_h15l3}+{zcfzbxxForm_h16l3}",
		"{zcfzbxxForm_h21l3}={zcfzbxxForm_h19l3}-{zcfzbxxForm_h20l3}",
		"{zcfzbxxForm_h23l3}={zcfzbxxForm_h21l3}-{zcfzbxxForm_h22l3}",
		"{zcfzbxxForm_h27l3}={zcfzbxxForm_h23l3}+{zcfzbxxForm_h24l3}+{zcfzbxxForm_h25l3}+{zcfzbxxForm_h26l3}",
		"{zcfzbxxForm_h32l3}={zcfzbxxForm_h29l3}+{zcfzbxxForm_h30l3}+{zcfzbxxForm_h31l3}",
		"{zcfzbxxForm_h36l3}={zcfzbxxForm_h14l3}+{zcfzbxxForm_h17l3}+{zcfzbxxForm_h27l3}+{zcfzbxxForm_h32l3}+"
				+ "{zcfzbxxForm_h35l3}",

		"{zcfzbxxForm_h15l5}={zcfzbxxForm_h1l5}+{zcfzbxxForm_h2l5}+{zcfzbxxForm_h3l5}+{zcfzbxxForm_h4l5}+"
				+ "{zcfzbxxForm_h5l5}+{zcfzbxxForm_h6l5}+{zcfzbxxForm_h7l5}+{zcfzbxxForm_h8l5}+"
				+ "{zcfzbxxForm_h9l5}+{zcfzbxxForm_h10l5}+{zcfzbxxForm_h11l5}+{zcfzbxxForm_h12l5}+"
				+ "{zcfzbxxForm_h13l5}+{zcfzbxxForm_h14l5}",
		"{zcfzbxxForm_h22l5}={zcfzbxxForm_h17l5}+{zcfzbxxForm_h18l5}+{zcfzbxxForm_h19l5}+{zcfzbxxForm_h20l5}+"
				+ "{zcfzbxxForm_h21l5}",
		"{zcfzbxxForm_h25l5}={zcfzbxxForm_h15l5}+{zcfzbxxForm_h22l5}+{zcfzbxxForm_h24l5}",
		"{zcfzbxxForm_h30l5}={zcfzbxxForm_h28l5}-{zcfzbxxForm_h29l5}",
		"{zcfzbxxForm_h35l5}={zcfzbxxForm_h30l5}+{zcfzbxxForm_h31l5}+{zcfzbxxForm_h32l5}+{zcfzbxxForm_h34l5}",
		"{zcfzbxxForm_h36l5}={zcfzbxxForm_h25l5}+{zcfzbxxForm_h35l5}",

		"{zcfzbxxForm_h15l6}={zcfzbxxForm_h1l6}+{zcfzbxxForm_h2l6}+{zcfzbxxForm_h3l6}+{zcfzbxxForm_h4l6}+"
				+ "{zcfzbxxForm_h5l6}+{zcfzbxxForm_h6l6}+{zcfzbxxForm_h7l6}+{zcfzbxxForm_h8l6}+"
				+ "{zcfzbxxForm_h9l6}+{zcfzbxxForm_h10l6}+{zcfzbxxForm_h11l6}+{zcfzbxxForm_h12l6}+"
				+ "{zcfzbxxForm_h13l6}+{zcfzbxxForm_h14l6}",
		"{zcfzbxxForm_h22l6}={zcfzbxxForm_h17l6}+{zcfzbxxForm_h18l6}+{zcfzbxxForm_h19l6}+{zcfzbxxForm_h20l6}+"
				+ "{zcfzbxxForm_h21l6}",
		"{zcfzbxxForm_h25l6}={zcfzbxxForm_h15l6}+{zcfzbxxForm_h22l6}+{zcfzbxxForm_h24l6}",
		"{zcfzbxxForm_h30l6}={zcfzbxxForm_h28l6}-{zcfzbxxForm_h29l6}",
		"{zcfzbxxForm_h35l6}={zcfzbxxForm_h30l6}+{zcfzbxxForm_h31l6}+{zcfzbxxForm_h32l6}+{zcfzbxxForm_h34l6}",
		"{zcfzbxxForm_h36l6}={zcfzbxxForm_h25l6}+{zcfzbxxForm_h35l6}"];
var sfdycbs;// 判断是否第一次报送财务报表
var bszldm;// 报送资料代码
var cjbz;// 采集标记
var sfkybc = false;
var djxh;
var cfcjbz;// 重复采集标记
var cfdz;// 存放地址

var ssqq;// 所属期起
var ssqz;// 所属期止
var zlsl;// 资料数量
var zllx;// 资料类型
var zlbsxlDm; // 资料小类代码
var zlbsdlDm;// 资料大类代码
var bbssq;//报表所属期
var lrbxxList = null;// 成功采集时上期返回的利润表信息
var xjllbxxList = null;// 成功采集时上期返回的现金流量表信息、
var syzqyxxList = null;// 成功采集时上期返回的所有者权益信息
var zcfzbxxList = null;// 上期资产负债表本年数
var sqlrblist = null; // 上期利润表本年累计数
var sqsyzlist = null;// 上期所有者表本年数
// 重复采集
var fblrbxx1 = null;// 附表保存回写的表单信息 利润表
var fbxjllbxx1 = null;// 附表保存回写的表单信息 现金流量表
var fbsyzqyxx1 = null;// 附表保存回写的表单信息 所有者权益表
// 附表回写
var fblrbxx = null;// 附表保存回写的表单信息 利润表
var fbxjllbxx = null;// 附表保存回写的表单信息 现金流量表
var fbsyzqyxx = null;// 附表保存回写的表单信息 所有者权益表
var sqssqq;
var sqssqz;
var sncjbz = 'N'; // 上年采集标志，如果采集则是Y,用于校验本期和上年数据
var snZc36; // 上年年末资产数据
var snQy36; // 上年年末权益数据
var qrcjBz = "N";
var bcAndGzUUid;// 受理信息的uuid,用于保存和更新采集表和明细表时使用
var sfcfcj;
var nsrxxMapInit;
var len;
var skssqq;// 所属期起
var skssqz;// 所属期止
var ctrl = 'SB100QykjzdcwbbbsyxxcjCtrl';// 定义全局CTRL
var zcfzbxxForm;
var qms1;// 资产负债表实收资本或股本期末数
var qms2;// 资产负债表资本公积期末数
var qms3;// 资产负债表盈余公积期末数
var qms4;// 资产负债表法定公益金
var qms5;// 资产负债表未分配利润期末数
var sqcfdz;// 上个月存放地址
var bsfsDm;// 报送方式代码
var bsxxlist;// 不同的报送属期
var jyflag = true;
var fjyscwbbuuid = null;
var fjfzuuid = null;
var sjgsdq = null;

//附件相关
var sfbhfj = null;
var nsrsbh = null;
var zgswskfjDm = null;
var ywzj = null;
var nsrxxFormInit;
var cxbj = null;
/**
 * 初始化处理
 * 
 * @param {Object}
 *            resData
 */
function init(resData) {
    cxbj = resData.getAttr("cxbj");
    if (cxbj == "N") {
        $w('zzsybnsrsb').setDisabled('save');
        $w('zzsybnsrsb').setDisabled('import');
        $w('zzsybnsrsb').setDisabled('reset');
        $w('zzsybnsrsb').setDisabled('downloadExcelTemplet');
        $w('zzsybnsrsb').setEnabled('print');
        $w('zzsybnsrsb').setDisabled('export');
        $w('zzsybnsrsb').setDisabled('back');
        $w("zcfzbxxForm").disable();   //此段需求看自己用附表FROM表单名置灰。
        $w("nsrxxForm").disable();   //此段需求看自己用附表FROM表单名置灰。
    }
    nsrxxMap = pc.getResData("nsrxxMap", resData);
    nsrxxFormInit = nsrxxMap;
    nsrxxForm = $w("nsrxxForm");
    nsrxxForm.disable(['nsrsbh']);
    zcfzbxxForm = $w('zcfzbxxForm');
    sfcfcj = resData.getAttr("sfcfcj");
    sqssqq = resData.getAttr("sqssqq");
    sqssqz = resData.getAttr("sqssqz");
    sfdycbs = resData.getAttr("reCode");
    bszldm = resData.getAttr("bszldm");
    djxh = resData.getAttr("djxh");
    bbssq = resData.getAttr("bbssq");
    skssqq = nsrxxMap.data.skssqq.value;
    skssqz = nsrxxMap.data.skssqz.value;
    cfdz = resData.getAttr("cfdz");
    zlsl = resData.getAttr("zlsl");
    zllx = resData.getAttr("zllx");
    zlbsxlDm = resData.getAttr("zlbsxlDm");
    zlbsdlDm = resData.getAttr("zlbsdlDm");
    zlbsuuid = resData.getAttr("zlbsuuid");
    bsfsDm = resData.getAttr("bsfsDm");
    sqcfdz = resData.getAttr("sqcfdz");
    $w("nsrxxForm").setValue("bbssq", bbssq);
    var newSubmit = new SwordSubmit();
    newSubmit.pushData('skssqq', skssqq);
    newSubmit.pushData('skssqz', skssqz);
    newSubmit.pushData('cfdz', cfdz);
    newSubmit.pushData('sqcfdz', sqcfdz);
    newSubmit.pushData('djxh', djxh);
    newSubmit.pushData('bsfsDm', bsfsDm);
    newSubmit.setCtrl("SB100QykjzdcwbbbsyxxcjCtrl_queryBssq");
    newSubmit.setFunction("onSuccess", "queryBssqSuccess");
    newSubmit.submit();

    nsrxxMapInit = pc.getResData("nsrxxMap", resData);
    ssqq = nsrxxMapInit.data.skssqq.value.substr(0, 10);
    ssqz = nsrxxMapInit.data.skssqz.value.substr(0, 10);

    //初始化附件相关信息
    sfbhfj = resData.getAttr("sfbhfj");
    if (sfbhfj == "Y") {
        nsrsbh = nsrxxMapInit.data.nsrsbh.value;
        zgswskfjDm = nsrxxMapInit.data.zgswskfjDm.value;
        ywzj = resData.getAttr("ywzj");
        ATTACH_FlZL_JSOBJ.setNsrsbh(nsrsbh);
        ATTACH_FlZL_JSOBJ.setZgswjDm(zgswskfjDm);
        ATTACH_FlZL_JSOBJ.setYwzj(ywzj);
    } else {
        $("fjxxGrid_id").setStyle("display", "none");
    }

    queryXmls();

    var year1 = ssqq.substr(0, 4);
    var year2 = year1 - 1;
    var month1 = ssqq.substr(5, 2);
    var month2 = ssqz.substr(5, 2);

}

function queryBssqSuccess(req, resData) {
    bsxxlist = pc.getResData("bsxxlist", resData);// 不同的报送属期
}
/**
 * 重复采集时查询上次采集XML
 */
var privatexmlbz = null;
function queryXmls() {
    // 如果属期信息list不是空，那么就查询每个属期的凭证化
    if (bsxxlist != null && bsxxlist != undefined && bsxxlist != "") {
        for (var i = 0; i < bsxxlist.trs.length; i++) {
            if (bsxxlist.trs[i].tds != null && bsxxlist.trs[i].tds != ""
					&& bsxxlist.trs[i].tds != undefined) {
                privatexmlbz = bsxxlist.trs[i].tds.xmlbz.value;
                var newSubmit = new SwordSubmit();

                if (privatexmlbz != "0" && privatexmlbz != "1"
						&& privatexmlbz != "5") {
                    var skssqz = bsxxlist.trs[i].tds.skssqz.value;
                    newSubmit.pushData('skssqq', skssqq);
                    newSubmit.pushData('skssqz', skssqz);
                }
                newSubmit.pushData('djxh', djxh);
                newSubmit.pushData('bszldm', bszldm);
                newSubmit.pushData("xmlbz", privatexmlbz);
                newSubmit.pushData('cfdz', cfdz);
                newSubmit.pushData('sqcfdz', sqcfdz);
                newSubmit.setCtrl("SB151zlbsslCtrl_checkSfcfbs");
                newSubmit.setFunction("onSuccess", "checkSuccess");
                newSubmit.submit();
            }
        }
    }
}
// 查询每个存在的存放地址的报文，并转换格式
function checkSuccess(req, resData) {
    if (resData.data.length > 1) {
        var cfdz = resData.data[0].trs[0].tds.cfdz.value;
        if (cfdz != null && cfdz != "" && cfdz != undefined) {
            var newSubmit = new SwordSubmit();
            newSubmit.pushData("xmlbz", privatexmlbz);
            newSubmit.pushData('cfdz', cfdz);
            newSubmit.setCtrl("SB100QykjzdcwbbbsyxxcjCtrl_queryXmlByzlbsuuid");
            newSubmit.setFunction("onSuccess", "cfcjSuccess");
            newSubmit.submit();
        } else if (sfcfcj == "N" && ("3" == privatexmlbz || "5" == privatexmlbz)) { //如果资产负债表为空，给提示
            swordAlert("资产负债表上年未采集数据");
        }
    }
}


var sqncsFlag = false;// 采用上期年初数
var zcfzbxxlistBnsq = null; //本年上期资产负债表

function cfcjSuccess(req, resData) {
    switch (privatexmlbz) {
        case "0":
            qykjzdZcfzbCjcgbj = pc.getResData("qykjzdZcfzbCjcgbj", resData).value;
            cfcjTyNsrxxForm = pc.getResData("nsrxxForm", resData);
            qykjzdZcfzbForm = pc.getResData("zcfzbxxForm", resData);
            fbxjllbxx = pc.getResData("xjllbxxForm", resData);
            fblrbxx = pc.getResData("lrbxxForm", resData);
            fbsyzqyxx = pc.getResData("qybxxForm", resData);

            setCfcjData(resData);
            if (qykjzdZcfzbCjcgbj == 'Y') {
                $w("zcfzbxxForm").initData(qykjzdZcfzbForm);
                $w("nsrxxForm").initData(cfcjTyNsrxxForm);
            }
            //启用导出按钮
            //$w('zzsybnsrsb').setEnabled('export');
            break;
        case "1":
            zcfzbxxlistBnsq = pc.getResData("zcfzbsnnmlist", resData);
            sqlrblist = pc.getResData("lrbbnsylist", resData);
            // 不是重复采集时，带回本年上期数据
            if (sfcfcj == "N") {
                if (ssqq.substr(5, 2) == "01") {
                    break;
                }
                loadBnsqZcfzb();
                sqncsFlag = true;
            }
            break;
        case "2":
            sqsyzlist = pc.getResData("qybsnbylist", resData);
            break;
        case "3":
            zcfzbxxlist = pc.getResData("zcfzbsnnmlist", resData);
            // 不是重复采集时，带回上年年末数据
            if (sfcfcj == "N" && !sqncsFlag) {
                loadSnmqZcfzb();
            }
            break;
        case "5":
            zcfzbxxlist = pc.getResData("zcfzbsnnmlist", resData);
            sqlrblist = pc.getResData("lrbbnsylist", resData);
            sqsyzlist = pc.getResData("qybsnbylist", resData);
            // 不是重复采集时，带回上年年末数据
            if (sfcfcj == "N" && !sqncsFlag) {
                loadSnmqZcfzb();
            }
            break;
    }
    if (zcfzbxxlist.trs.length > 0) {
        sncjbz = 'Y';
    }

}
function loadBnsqZcfzb() {

    var zcfzbxxForm = $w("zcfzbxxForm");
    for (var i = 0; i < zcfzbxxlistBnsq.trs.length; i++) {
        var ewbhxh = zcfzbxxlistBnsq.trs[i].tds.ewbhxh.value;
        var sqncsZc = zcfzbxxlistBnsq.trs[i].tds.ncsZc.value;
        var sqncsQy = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        zcfzbxxForm.setValue("h" + ewbhxh + "l2", sqncsZc);
        zcfzbxxForm.setValue("h" + ewbhxh + "l5", sqncsQy);
        if (ewbhxh == "36") {
            snZc36 = zcfzbxxlistBnsq.trs[i].tds.ncsZc.value;
            ;
            snQy36 = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        }
        if (ewbhxh == "30") {
            qms1 = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        }
        if (ewbhxh == "31") {
            qms2 = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        }
        if (ewbhxh == "32") {
            qms3 = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        }
        if (ewbhxh == "33") {
            qms4 = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        }
        if (ewbhxh == "34") {
            qms5 = zcfzbxxlistBnsq.trs[i].tds.ncsQy.value;
        }
    }
}
/**
 * 加载上年末期资产负债表
 */
function loadSnmqZcfzb() {

    var zcfzbxxForm = $w("zcfzbxxForm");
    for (var i = 0; i < zcfzbxxlist.trs.length; i++) {
        var ewbhxh = zcfzbxxlist.trs[i].tds.ewbhxh.value;
        var qmsZc = zcfzbxxlist.trs[i].tds.qmsZc.value;
        var qmsQy = zcfzbxxlist.trs[i].tds.qmsQy.value;
        zcfzbxxForm.setValue("h" + ewbhxh + "l2", qmsZc);
        zcfzbxxForm.setValue("h" + ewbhxh + "l5", qmsQy);
        if (ewbhxh == "36") {
            snZc36 = zcfzbxxlist.trs[i].tds.qmsZc.value;
            ;
            snQy36 = zcfzbxxlist.trs[i].tds.qmsQy.value;
        }
        if (ewbhxh == "30") {
            qms1 = zcfzbxxlist.trs[i].tds.qmsQy.value;
        }
        if (ewbhxh == "31") {
            qms2 = zcfzbxxlist.trs[i].tds.qmsQy.value;
        }
        if (ewbhxh == "32") {
            qms3 = zcfzbxxlist.trs[i].tds.qmsQy.value;
        }
        if (ewbhxh == "33") {
            qms4 = zcfzbxxlist.trs[i].tds.qmsQy.value;
        }
        if (ewbhxh == "34") {
            qms5 = zcfzbxxlist.trs[i].tds.qmsQy.value;
        }
    }
}

/**
 * @param toolBarName
 *            工具条名称
 * @param arr
 *            需要控制的按钮name
 * @param flag
 *            彩色还是黑白
 */
function toolBarCtl(toolBarName, arr, flag) {
    if (flag == "disabled") {
        arr.each(function (value, key) {
            $w(toolBarName).setDisabled(value);
        });
    } else if (flag == "enabled") {
        arr.each(function (value, key) {
            $w(toolBarName).setEnabled(value);
        });
    }
}
function select(req) {
    var selectBtn = new SwordSubmit();
    var nsrxxForm = $w("nsrxxForm");
    var ssqq = "";
    var ssqq = nsrxxForm.getValue("skssqq"); // 等受理页面给传值
    selectBtn.pushData("zlbscjuuid", zlbscjuuid);
    selectBtn.pushData("ssqq", skssqq);
    selectBtn.setCtrl("SB100QykjzdcwbbbsyxxcjCtrl_select");
    selectBtn.setFunction('onSuccess', 'selectSbxxOnSuccess');
    selectBtn.submit();
}

function selectSbxxOnSuccess(res) {
    // zcfzbxxForm=pc.getResData("zcfzbxxForm", resData);
}
var cfcjTyNsrxxForm = null;//
var qykjzdZcfzbForm = null;// 企业会计制度资产负债表
var qykjzdZcfzbCjcgbj = 'N';// 资产负债表
var qykjzdXjllbCjcgbj = 'N';// 现金流量表
var qykjzdlrbCjcgbj = 'N';// 利润表
var qykjzdSyzqybdbCjcgbj = 'N';// 所有者权益变动表

/**
 * 
 * @param req
 * @param resData
 * @return
 */
function jySuccess(req, resData) {
    var box = this.parent[this.name];
    cjbz = pc.getResData("cjbz", resData).value;
    var nsrxxForm = $w("nsrxxForm");
    if (cjbz == '0') {
        var result = pc.getResData("result", resData).value;
        var out = "";
        // 如果纳税人不是第一次报送，并且未查询出上期成功采集，则提示，终止流程，必须重新采集上期
        if (parseInt(result) == 1) {
            out = "月报";
        } else if (parseInt(result) == 3) {
            out = "季报";
        }
        // 提示哪几个月未报送
        var bsSsqq = nsrxxForm.getValue("skssqq");
        var nianBs = bsSsqq.substring(0, 4);// 7
        var yueBs = bsSsqq.substring(5, 7);// 7
        var skNian = sqssqz.substring(0, 4);
        var skYue = sqssqz.substring(5, 7);// 3
        var str = "";
        // 如果是隔月报 就是比如先报送了2月份 然后再回头报1月份的情况 回头报送的话 不提示监控
        if (parseInt(yueBs, 10) < parseInt(skYue, 10)
				&& parseInt(nianBs) <= parseInt(skNian)) {
            return;
        }
        // 待优化 监控以后可以由前台移植到后台java代码
        if (parseInt(nianBs) == parseInt(skNian)
				&& (parseInt(yueBs, 10) - 1) == (parseInt(skYue, 10) + 1)) {
            str = skNian + "年" + (parseInt(skYue, 10) + 1) + "月";
        } else {
            if (parseInt(yueBs, 10) - 1 != 0 && parseInt(skYue, 10) + 1 != 12) {
                str = skNian + "年" + (parseInt(skYue, 10) + 1) + "月~" + nianBs
						+ "年" + (parseInt(yueBs, 10) - 1) + "月";
            } else if (parseInt(yueBs, 10) - 1 == 0
					&& parseInt(skYue, 10) + 1 != 12) {
                if (parseInt(nianBs) - parseInt(skNian) > 1) {
                    str = skNian + "年" + (parseInt(skYue, 10) + 1) + "月~"
							+ (parseInt(nianBs) - 1) + "年12月";
                } else {
                    str = skNian + "年" + (parseInt(skYue, 10) + 1) + "月~12月";
                }

            } else if (parseInt(skYue, 10) + 1 == 12
					&& parseInt(yueBs, 10) - 1 != 0) {
                str = skNian + "年" + (parseInt(skYue, 10) + 1) + "月~" + nianBs
						+ "年" + (parseInt(yueBs, 10) - 1) + "月";
            } else {
                str = skNian + "年" + (parseInt(skYue, 10) + 1) + "月";
            }
        }
        swordConfirm(str + "份未采集或者未采集成功,报送类型:" + out + ",是否进行采集?", {
            okBtnName: "是",
            cancelBtnName: "否",
            onOk: function () {
                qrcjBz = "Y";
            },
            onCancel: function () {
                $w("bcBtn").disabled();
            }
        });
    }
    if (cjbz == '1') {
        // 如果上期成功采集,将上期采集的数据带到本期页面
        gyxssq();
    }
    if (cjbz == '2') {
        // 报的是年报
    }
}
// 1.资产负债表
var sqb37;// 资产负债表反解析的上期数据负债和所有者权益(或股东权益)总计 期末数据
var sqd37;// 上期资产总计期末数据
// 2.利润表
var bnsqb16;
// 3.现金流量表
// 4.所有者 权益表
var sqa8, sqa20, sqa34, sqa43, sqa47;
var zcfcbCjcgbj = 'N';// 资产负债表成功采集标记 默认为否
var lrbCjcgbj = 'N';// 利润表成功采集标记 默认为否
var qybCjcgbj = 'N';// 权益表成功采集标记 默认为否
function sqzcfzbxxOnSuccess(req, resData) {
    // 1.资产负债表后台返回信息
    var sb100zcfzb_listData = pc.getResData("zcfzbxxForm", resData);
    zcfzbxxList = sb100zcfzb_listData;
    sqb37 = resData.getAttr("h36l3");
    sqd37 = resData.getAttr("h36l3");
    $w("zcfzbxxForm").initData(zcfzbxxList);
    zcfcbCjcgbj = resData.getAttr("zcfcbCjcgbj");


    // 2.利润表后台返回数据
    var sb100lrb_listData = pc.getResData("lrbxxForm", resData);
    lrbxxList = sb100lrb_listData;
    bnsqb16 = resData.getAttr("h15l3");
    lrbCjcgbj = resData.getAttr("lrbCjcgbj");

    // 3.现金流量表后台返回数据
    // 4.所有者信息后台返回数据
    var sb100Syzqy_listData = pc.getResData("qybxxForm", resData);
    syzqyxxList = sb100Syzqy_listData;
    sqa8 = resData.getAttr("h8l2");
    sqa20 = resData.getAttr("h19l2");
    sqa34 = resData.getAttr("a34");
    sqa43 = resData.getAttr("a43");
    sqa47 = resData.getAttr("a47");
    qybCjcgbj = resData.getAttr("qybCjcgbj");

    var ndcwkjbgshbgForm = pc.getResData("ndcwkjbgshbgForm", resData);
    zlbsfbsaveData.set("年度财务会计报告审计报告", ndcwkjbgshbgForm);
}
/**
 * /** 资产负债和所有者权益平衡校验 (资产负债表中“资产总计”金额必须等于“负债和所有者权益（或股东权益）总计”金额)
 */
function checkZcfzhsyzqyphjy() {
    var zcfzbxxForm = $w("zcfzbxxForm");
    var zczjc = zcfzbxxForm.getValue("h36l2");// 资产总计初
    var zczjm = zcfzbxxForm.getValue("h36l3");// 资产总计末
    var fzzjc = zcfzbxxForm.getValue("h36l5");// 负债总计初
    var fzzjm = zcfzbxxForm.getValue("h36l6");// 负债总计末
    if (parseFloat(zczjc) != parseFloat(fzzjc)
			|| parseFloat(zczjm) != parseFloat(fzzjm)) {
        swordAlert("资产负债表中'资产总计'金额不等于'负债和所有者权益(或股东权益)总计'金额,不能保存!");
        return false;
    }
    return true;
}

/**
 * 保存前验证
 */
function saveBeforeCheck() {
    var nsrxxForm = $w('nsrxxForm');
    if (!nsrxxForm.validate()) {
        return;
    }
    var zcfzbxxForm = $w('zcfzbxxForm');
    if (!zcfzbxxForm.validate()) {
        return;
    }
    //if (checkZcfzhsyzqyphjy()) {
    jyfbsfbc();
    //}	
}

function saveTrue() {

    //if (checkZcfzhsyzqyphjy()) {
    // var
    var nsrxxFormData = $w("nsrxxForm").getSubmitData();
    var zcfzbxxxxFormData = $w("zcfzbxxForm").getSubmitData();
    var saveBtn = new SwordSubmit();
    saveBtn.pushData(nsrxxFormData);
    saveBtn.pushData(zcfzbxxxxFormData);
    // 将主表和附表信息一起提交进行保存
    saveBtn.pushData(fblrbxx);// 子页面返回的利润表信息
    saveBtn.pushData(fbxjllbxx);// 子页面返回的现金流量表信息
    saveBtn.pushData(fbsyzqyxx);// 子页面返回的现所有者权益表信息
    // }

    // xml导入保存数据直接封装
    for (var key in fbXMLData) {
        if (fbXMLData[key] != undefined && fbXMLData[key] != null) {
            saveBtn.pushData(fbXMLData[key].value);
        }
    }
    saveBtn.pushData('cfdz', cfdz);
    saveBtn.pushData('bszldm', bszldm);
    saveBtn.pushData('djxh', djxh);
    saveBtn.pushData('zlsl', zlsl);
    saveBtn.pushData('zllx', zllx);
    saveBtn.pushData('zlbsxlDm', zlbsxlDm);
    saveBtn.pushData('zlbsdlDm', zlbsdlDm);
    saveBtn.pushData('zlbsuuid', zlbsuuid);
    saveBtn.pushData('sfcfcj', sfcfcj);
    saveBtn.pushData($w("zcfzbxxForm").getSubmitData());
    saveBtn.pushData($w("nsrxxForm").getSubmitData());
    //保存附件信息
    if (sfbhfj == "Y") {
        var flzlStr = ATTACH_FlZL_JSOBJ.getFlzlList();
        saveBtn.pushData("flzlList", flzlStr);
        saveBtn.pushData("zgswjDm", zgswskfjDm);
        saveBtn.pushData("ywzj", ywzj);
    }
    saveBtn.pushData("sfbhfj", sfbhfj);
    saveBtn = zlbssavePushdata(saveBtn);
    saveBtn.setCtrl("SB100QykjzdcwbbbsyxxcjCtrl_saveZcfzb");
    saveBtn.setFunction('onSuccess', 'cjSuccess');
    saveBtn.submit();
    //}
}

function checkzcfzb() {
    var zcfzbxxFormData = $w("zcfzbxxForm").getSubmitData();

    var sszbhgb = $w("zcfzbxxForm").getValue("h28l6");
    var jyghtz = $w("zcfzbxxForm").getValue("h29l6");
    var sszbhgbje = $w("zcfzbxxForm").getValue("h30l6");
    var zbgj = $w("zcfzbxxForm").getValue("h31l6");
    var yygj = $w("zcfzbxxForm").getValue("h32l6");
    var qzfdgyj = $w("zcfzbxxForm").getValue("h33l6");
    var wfply = $w("zcfzbxxForm").getValue("h34l6");

    var h1l2 = 0.0;
    var h7l2 = 0.0;
    var h8l2 = 0.0;
    var h20l2 = 0.0;
    var h34l2 = 0.0;
    var h35l2 = 0.0;
    var h47l2 = 0.0;
    if ($chk(fbsyzqyxx)) {
        h1l2 = (fbsyzqyxx.data.h1l2.value) / 1 + (fbsyzqyxx.data.h2l2.value) / 1;
        h7l2 = fbsyzqyxx.data.h7l2.value;
        h8l2 = fbsyzqyxx.data.h8l2.value;
        h20l2 = fbsyzqyxx.data.h20l2.value;
        h34l2 = fbsyzqyxx.data.h34l2.value;
        h35l2 = fbsyzqyxx.data.h35l2.value;
        h47l2 = fbsyzqyxx.data.h47l2.value;
    }
    if (sszbhgb / 1 != h1l2 / 1 || jyghtz / 1 != h7l2 / 1 || sszbhgbje / 1 != h8l2 / 1 || zbgj / 1 != h20l2 / 1 || yygj / 1 != h34l2 / 1 || qzfdgyj / 1 != h35l2 / 1 || wfply / 1 != h47l2 / 1) {
        swordConfirm("资产负债表中所有者权益(或股东权 益)与所有者权益变动表中金额不相等,是否继续?", {
            onOk: function () {
                checkZcfzbNcye();
            },
            onCancel: function () {
                return false;
            }
        });
    } else {
        checkZcfzbNcye();
    }
}

/**
 * 检查资产负债表年初余额是否与上年末期期末余额相等
 */
function checkZcfzbNcye() {

    var zcfzbxxForm = $w("zcfzbxxForm");
    var names = [];
    if (sncjbz == "Y") {
        for (var i = 0; i < zcfzbxxlist.trs.length; i++) {
            var ewbhxh = zcfzbxxlist.trs[i].tds.ewbhxh.value;
            var qmsZc = zcfzbxxlist.trs[i].tds.qmsZc.value;
            var qmsQy = zcfzbxxlist.trs[i].tds.qmsQy.value;
            var ncsZc = zcfzbxxForm.getValue("h" + ewbhxh + "l2");
            var zcName = zcfzbxxForm.getValue("h" + ewbhxh + "l1");
            var ncsQy = zcfzbxxForm.getValue("h" + ewbhxh + "l5");
            var qyName = zcfzbxxForm.getValue("h" + ewbhxh + "l4");

            if (Number(qmsZc) != Number(ncsZc)) {
                names.push(zcName);
            } if (Number(qmsQy) != Number(ncsQy)) {
                names.push(qyName);
            }
        }
    }

    if (names.length > 0) {
        var nameStr = names.toString().replace(/(\s|(\u00A0)|(\u3000))/g, '');
        swordConfirm("资产负债表中，年初数与上年末期期末数不相等，是否继续？"
				+ "<br/>数据项：[" + nameStr + "]",
				{
				    onOk: function () {
				        saveTrue();
				    },
				    onCancel: function () {
				        return false;
				    }
				});
    } else {
        saveTrue();
    }
}
// 校验附表是否报送
function jyfbsfbc() {
    var meg = "";
    if (fblrbxx == null || fblrbxx == undefined || fblrbxx == "") {
        meg += "利润表、";
    }
    if (fbxjllbxx == null || fbxjllbxx == undefined || fbxjllbxx == "") {
        meg += "现金流量表、";
    }
    if (fbsyzqyxx == null || fbsyzqyxx == undefined || fbsyzqyxx == "") {
        meg += "所有者权益变动表、";
    }
    meg = fbsaveCheck(meg);
    //	if (meg != "") {
    //		meg = meg.substring(0, meg.length - 1);
    //		swordConfirm(meg + "未采集，是否确定？", {
    //			onOk : function() {
    //				jyOKflag();
    //			},
    //			onCancel : function() {
    //				jyNoflag();
    //			}
    //		});
    //	} else {
    //		jyOKflag();
    //	}

    if (meg != "") {
        meg = meg.substring(0, meg.length - 1);
        swordConfirm(meg + "未采集，是否保存？", {
            onOk: function () {
                checkzcfzb();
            },
            onCancel: function () {
                return false;
            }
        });
    } else {
        checkzcfzb();
    }
    //	return jyflag;
}
function jyOKflag() {
    jyflag = true;
    checkzcfzb();
}
function jyNoflag() {
    jyflag = false;
}

function cjSuccess(req, resData) {

    var flag = pc.getResData("flag", resData).value;
    if (flag == "Y") {
        swordAlertRight("财务报表信息采集完成且发送成功！", {
            onOk: function () {
                //				$w('zzsybnsrsb').setEnabled('export');
                $w('zzsybnsrsb').setDisabled('reset');
                $w('zzsybnsrsb').setDisabled('import');
                $w('zzsybnsrsb').setDisabled('save');
                $w("SwordTreeJSON").clear();
                var tree = $w("SwordTreeJSON");
                tree.reloadTree("{ 'data':[{'code':'000','caption':''}]}");
            }
        });
    } else {
        swordAlert("采集失败");
    }



}
/**
 * 取消
 */
function reset() {
    $w('zcfzbxxForm').resetAll();
}

var sb100_boolean_fb01 = false;
var sb100_boolean_fb02 = false;
var sb100_boolean_fb03 = false;

function setHx(a, win) {
    // 将父页面的元素传到子页面
    var nsrsbh = $w("nsrxxForm").getValue("nsrsbh");
    var nsrmc = $w("nsrxxForm").getValue("nsrmc");
    var bsrq = $w("nsrxxForm").getValue("bsrq");
    var skssqq = $w("nsrxxForm").getValue("skssqq");
    var skssqz = $w("nsrxxForm").getValue("skssqz");
    //	var bbssq=$w("nsrxxForm").getValue("bbssq");
    if (a == "01") {
        // 利润表
        if (sfcfcj == 'Y' || drCgbj == 'Y') {
            win.setCfcjInitValue(cfcjTyNsrxxForm, sqlrblist, fblrbxx, cfcjbz);
        } else {
            win.setInitValue(nsrsbh, nsrmc, bsrq, skssqq, skssqz, sqlrblist, bbssq);
        }
    } else if (a == "02") {
        // 现金流量表
        if (sfcfcj == 'Y' || drCgbj == 'Y') {
            win.setCfcjInitValue(cfcjTyNsrxxForm, fbxjllbxx, cfcjbz);
        } else {
            win.setInitValue(nsrsbh, nsrmc, bsrq, skssqq, skssqz);
        }
    } else if (a == "03") {
        // 权益表
        if (sfcfcj == 'Y' || drCgbj == 'Y') {
            win.setCfcjInitValue(cfcjTyNsrxxForm, sqsyzlist, fbsyzqyxx, cfcjbz, qms1, qms2, qms3, qms4, qms5);
        } else {
            win.setInitValue(nsrsbh, nsrmc, bsrq, skssqq, skssqz, sqsyzlist, qms1, qms2, qms3, qms4, qms5);
        }
    }
}
/**
 * 附表保存回写主表事件
 * 
 * @param sb099Form
 * @param bj
 */
function hxFb(sb100Form, bj, isDrInit) {
    var table00 = $("table00");
    var table01 = $("table01");
    var table02 = $("table02");
    var table03 = $("table03");
    if (bj == '01') {// 利润表保存回写
        fblrbxx = sb100Form.getSubmitData();
        if (!isDrInit) {
            swordAlert("利润表信息采集完成且发送成功！");
        }
    } else if (bj == '02') {// 现金流量表回写
        fbxjllbxx = sb100Form.getSubmitData();
        if (!isDrInit) {
            swordAlert("现金流量表信息采集完成且发送成功！");
        }
    } else if (bj == '03') {// 所有者权益表回写
        fbsyzqyxx = sb100Form.getSubmitData();
        if (!isDrInit) {
            swordAlert("所有者权益变动表信息采集完成且发送成功！");
        }
    }
    // 回写玩将其他子页面全部关闭,只打开父页面
    table00.setStyle('display', '');
    table01.setStyle('display', 'none');
    table02.setStyle('display', 'none');
    table03.setStyle('display', 'none');
    $w('zzsybnsrsb').setEnabled('save');
    $w('zzsybnsrsb').setEnabled('import');
    $w('zzsybnsrsb').setEnabled('reset');
}


/**
 * 导入
 * 
 * @return
 */
function getDrxx() {
    var gydrctrl = ctrl + "_getDrxx";// 导入处理自定义的ctrl
    var drxxBtn = new SwordSubmit();
    if ($chk(djxh)) {
        drxxBtn.pushData('djxh', djxh);
    }
    drxxBtn.pushData('gydrCtrl', gydrctrl);
    drxxBtn.setCtrl('GYDrCtrl_openDr');// 公用导入方法
    swordAlertIframe('', {
        titleName: "申报信息导入",
        width: 450,
        height: 300,
        param: window,
        isNormal: 'true',
        isMax: 'true',
        isClose: 'true',
        isMin: "true",
        submit: drxxBtn
    });
}
var drCgbj;
var beSbdr = false;
function boxCallBackForSBdr(resData) {
    cfcjTyNsrxxForm = pc.getResData("nsrxxForm", resData);
    // qykjzdZcfzbForm=pc.getResData("zcfzbxxForm", resData);
    if (pc.getResData("xjllbxxForm", resData)) {
        fbxjllbxx = pc.getResData("xjllbxxForm", resData);
        fbxjllbxx = JSON.decode(JSON.encode(fbxjllbxx));
    }
    if (pc.getResData("lrbxxForm", resData)) {
        fblrbxx = pc.getResData("lrbxxForm", resData);
        fblrbxx = JSON.decode(JSON.encode(fblrbxx));
    }
    if (pc.getResData("qybxxForm", resData)) {
        fbsyzqyxx = pc.getResData("qybxxForm", resData);
        fbsyzqyxx = JSON.decode(JSON.encode(fbsyzqyxx));
    }
    setCfcjData(resData);

    var qykjzdZcfzbForm = pc.getResData("zcfzbxxForm", resData);
    var nsrsbh = $w("nsrxxForm").getValue("nsrsbh");// 从受理页面带到表单页面上的nsrsbh
    var nsrsbh1 = cfcjTyNsrxxForm.data.nsrsbh.value;// 从导入报文中获取的nsrsbh
    var nsrmc = $w("nsrxxForm").getValue("nsrmc");// 从受理页面带到表单页面上的nsrsbh
    var nsrmc1 = cfcjTyNsrxxForm.data.nsrmc.value;// 从导入报文中获取的nsrsbh
    var ssqq1 = cfcjTyNsrxxForm.data.skssqq.value;
    var ssqz1 = cfcjTyNsrxxForm.data.skssqz.value;
    if (nsrsbh != nsrsbh1) {
        swordAlert("导入的XML报文和受理页面的纳税人识别号不一致,请核对后再导入！");
        return;
    } else if (nsrmc != nsrmc1) {
        swordAlert("导入的XML报文和受理页面的纳税人名称不一致,请核对后再导入！");
        return;
    } else if (ssqq.substring(0, 10) != ssqq1.substring(0, 10) || ssqz.substring(0, 10) != ssqz1.substring(0, 10)) {
        swordAlert("导入的XML报文和受理页面的所属期起止不一致,请核对后再导入！");
        return;
    } else {
        drCgbj = "Y";
        $w("zcfzbxxForm").initData(qykjzdZcfzbForm);
        $w("nsrxxForm").initData(cfcjTyNsrxxForm);
    }
    //导入自动触发计算公式校验
    var inputs = $$('input');
    inputs.each(function (input, idx) {
        if (input.id != "") {
            caculate(input.id);
        }
    });
    beSbdr = true;
    var data = $w('SwordTreeJSON').getAllNode();
    var zb = null;
    data.each(function (item, idx) {
        if (idx == 0) {
            zb = item;
        }
        openTab(item);

    })
    openTab(zb);
}


/**
 * 申报导入
 * 
 * @param resData
 * @return
 */
var fbXMLData = {};
var sb100_resDataXMLForSBDR;
function XMLForSBDR(resData) {

    sb100_resDataXMLForSBDR = JSON.encode(resData);
    fbXMLData["zcfzbxxForm"] = pc.getResData("zcfzbxxForm", resData);
    if (fbXMLData["zcfzbxxForm"] != null && fbXMLData["zcfzbxxForm"] != undefined && fbXMLData["zcfzbxxForm"].sword != null && fbXMLData["zcfzbxxForm"].sword != undefined && fbXMLData["zcfzbxxForm"].sword != "") {
        $w("zcfzbxxForm").initData(fbXMLData["zcfzbxxForm"]);
        $w("zcfzbxxForm").disable();

        // 项目名称不置灰
        for (var i = 1; i <= 17; i++) {
            $w("zcfzbxxForm").enable(["h" + i + "l1"]);
        }
        for (var i = 19; i <= 27; i++) {
            $w("zcfzbxxForm").enable(["h" + i + "l1"]);
        }
        for (var i = 29; i <= 32; i++) {
            $w("zcfzbxxForm").enable(["h" + i + "l1"]);
        }
        $w("zcfzbxxForm").enable(["h35l1"]);
        $w("zcfzbxxForm").enable(["h36l1"]);
        for (var i = 1; i <= 15; i++) {
            $w("zcfzbxxForm").enable(["h" + i + "l4"]);
        }
        for (var i = 17; i <= 22; i++) {
            $w("zcfzbxxForm").enable(["h" + i + "l4"]);
        }
        $w("zcfzbxxForm").enable(["h24l4"]);
        $w("zcfzbxxForm").enable(["h25l4"]);
        for (var i = 28; i <= 36; i++) {
            $w("zcfzbxxForm").enable(["h" + i + "l4"]);
        }
    }

    var qybxxForm = pc.getResData("qybxxForm", resData);
    if (qybxxForm != null && qybxxForm != undefined && qybxxForm.sword != null && qybxxForm.sword != undefined && qybxxForm.sword != "") {

        fbXMLData["qybxxForm"] = { 'value': qybxxForm };
    }

    var lrbxxForm = pc.getResData("lrbxxForm", resData);
    if (lrbxxForm != null && lrbxxForm != undefined && lrbxxForm.sword != null && lrbxxForm.sword != undefined && lrbxxForm.sword != "") {
        fbXMLData["lrbxxForm"] = { 'value': lrbxxForm };
    }

    var xjllbxxForm = pc.getResData("xjllbxxForm", resData);
    if (xjllbxxForm != null && xjllbxxForm != undefined && xjllbxxForm.sword != null && xjllbxxForm.sword != undefined && xjllbxxForm.sword != "") {
        fbXMLData["xjllbxxForm"] = { 'value': xjllbxxForm };
    }

    sb100_boolean_fb01 = false;
    sb100_boolean_fb02 = false;
    sb100_boolean_fb03 = false;
}

/**
 * Excel模板下载
 */
function downloadExcelTemplet() {
    var ctrlSub = new SwordSubmit();
    ctrlSub.options.postType = "download";
    ctrlSub.setCtrl("GYDrCtrl_download?fileName=/template/sb/sb100/CWBB_QYKJZD_V1.0.xls");
    ctrlSub.submit();
    //	swordAlert("该财务报表暂未提供Excel模板");
}

/**
 * Excel导出
 */
function exportsbxx() {
    var submitBtn = new SwordSubmit();
    submitBtn.pushData("cfdz", cfdz);
    submitBtn.pushData("djxh", djxh);
    submitBtn.pushData("bszlDm", bszldm);
    submitBtn.pushData("ssqq", $w("nsrxxForm").getValue("skssqq"));
    submitBtn.pushData("ssqz", $w("nsrxxForm").getValue("skssqz"));
    submitBtn.setCtrl(ctrl + "_exportExcel");
    var options = {};
    options.postType = "download";
    submitBtn.setOptions(options);
    submitBtn.setFunction("onSuccess", "onSuccessDc");
    submitBtn.submit();
    //	swordAlert("该财务报表暂未提供Excel模板");
}
//页面返回
function backSfxywh() {
    var box = this.parent[this.name];
    box.close();

}

//打印所需变量
var printFileType = "excel";
var hxdyForPrint = "N";
var dymbuuid = "";
var zzlx = "A4";
var fykg = "N";
var caculateGridHJFlag = "N";
var printMode = '{"PRINT_PAGE_PERCENT":"70%"}';
var tsxx;//打印标题
var ccbg;//超长表格
var printTitle = "资产负债表(适用执行企业会计制度的企业)";
function setZbdymbuuid() {
    dymbuuid = "sb100_qykjzdcwbbbsyxxcj00";
    return dymbuuid;
}
function printhtm() {
    gyTaxPrintWordOrExcel();
}